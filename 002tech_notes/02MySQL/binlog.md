# binlog

## 1 记录内容
binlog 中记录了对MySQL数据库执行更改的所有操作，并且记录了语句发生时向、执行时长、操作数据等其它额外信息，但是它不记录select、 show等那些不修改数据的SQL语句。


## 2 作用
1. 数据恢复
2. 主从复制
3. 操作审计


## 3 binlog格式
### 3.1 statement 格式
statement模式下的 binlog 记录的是数据库执行的原生SQL语句。采用该格式的二进制日志文件最小，性能最高，主从复制网络带宽小，但很容易出现主从不一致的问题。

#### 3.1.1 优点
statement模式下，不需要记录每一行的变化，所以bin-log日志量相对较小，节约IO，提高性能。因为它只需要记录所执行的语句的细节，以及执行语句时的上下文信息。

#### 3.1.2 缺点
由于它是记录执行语句，为了让这些语句在slave端也能正确执行，它还必须记录每条语句在执行的时候的一些相关信息，也就是上下文信息，来保证所有语句在slave端能够得到和在master端相同的执行结果。statement模式下，**在执行一些不确定的函数（如uuid(),now()）时会出现主从数据不一致问题**。


### 3.2 row 格式
binlog 记录的是数据行的更改情况，即数据行在更改前、更改后的变化情况，所以row模式下的二进制日志文件最大，对性能会有一定影响，主从复制网络带宽高，但**在主从复制模式下可靠性最好**。

#### 3.2.1 优点
在row模式下，binlog中不需要记录执行的sq|l语句的上下文信息，仅仅只需要记录哪一条记录被修改，修改成什么样，所以日志內容会非常清楚的记录每一行数据修改的细节。不会存在数据一致性问题。

#### 3.2.2 缺点
row模式下，所有的执行语句都会记录到日志中，同时都会以每行记录修改的来记录，这样生成的日志内容将会非常大，占用空间。新版本中的mysql中对row模式也做了优化，并不是所有的修改都会以row来记录，像遇到表结构变更的时候就会以statement模式来记录，如果sql语句确实就是update或者delete等修改数据的语句，那么还是会记录所有行的变更。

### 3.3 mixed 格式
![[attachments/Pasted image 20220613000750.png]]
不推荐使用

## 4 删除binlog
