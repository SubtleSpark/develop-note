# 项目开发流程
## 1 开发阶段
![[attachments/Pasted image 20220520100508.png]]

### 1.1 系统搭建
通常我们会按照一个系统需要服务建设的**复杂度**来选择搭建的框架，比如：**单体架构、分布式架构、分库分表架构、分层架构**等，按照不同的体量进行选择。
如果是较大型的系统开发则会把**不同的职责**拆分为独立的系统进行开发，包括：基础层、业务层、网关层、任务层、异步层。
- **基础层**处理数据库、Redis、ES的使用以及提供**原子接口**。
- **业务层**用于包装业务
- **网关层**提供Http接口。
- **任务层**处理分布式任务。
- **异步层**用于接收MQ消息。

### 1.2 数据服务
一般互联网中的系统大部分都是使用 MySql 作为数据库服务使用，因为它是免费的。
如果数据量较大还可以使用**分库分表**策略进行设计数据库。
如果分库分表，那么散落在各个库表里的数据，就需要基于binlog 使用 otter 工具把数据同步到 ES 中，便于汇总查询。

### 1.3 测试环境
在一些大厂开发中，通常本地的开发机器是不能直接启动运行测试完整流程的，需要把服务部署到测试环境，才可以正常调用访问一些相关资源。

### 1.4 功能开发
从一个系统的开发过程可以包括：数据库表创建、**原子服务开发** #unknown  、业务逻辑串联、领域功能实现、网关接口包装，一层层搭建和开发各个模块的功能。重在思考领域的建设，把隔层的实现分离到各个层里，避免互相污染。常用技术使用上包括：RPC、MQ、分布式任务、配置中心、网关、Redis

### 1.5 单元测试
其实这个是一个研发标准或者内部自发的约定，因为很大一部分研发是不写单测的，也不考虑单测覆盖率，这样的代码通常在交付测试以后会有很大的风险，其实编写单元测试是提升研发交付质量非常重要的一环，只有你自己已经完整地测试过的代码，才会保证如期交付上线。

### 1.6 接口联调
在接口联调阶段主要包括自身功能开发对接外部，和自己提供出去的接口。通常在服务端开发完成接口的30%时，可以把部分接口提供给前端，前端开始对接接口，服务端陆续提供新的接口。直至所有接口对接完成并联调通过。

### 1.7 提交测试
在研发开发完成并代码评审以后，接下来就是对整个系统开始提交测试阶段。这个时候需要按照约定提交测试报告，包括：涉及的系统、开发的接口、单测覆盖度等。

## 2 系统上线维护
![[attachments/Pasted image 20220520180144.png]]

当系统开发完成并已经全部测试以后，就到了正式发布上线的阶段。通常在测试阶段还会包括预发测试，预发环境一般都是单台的数据库和单台的服务，所以正式上线时需要申请新的资源，并配置相应信息以及初始化服务和数据。

### 2.1 环境
通常在测试人员发出系统测试通过后，研发人员会在测试的邮件上，发送一个系统上线通知。这样所有和系统相关的人员：研发、产品、运营、业务，都会做属于自己的工作。配合的研发人员会进行提前的接口发布提供服务、前端会等待后端的接口上线、运营会配置好活动以及等待新系统上线后的配置、业务人员会做一些计划。而自己内部的研发则需要把所有上线时需要准备好的环境处理完毕，等待系统开发上线。

### 2.2 部署
在系统部署阶段，一般公司内部可能会因为系统的使用范围有不同的上线标准，可能有些是手动发布，有些是服务上云弹性发布。那么这些手动发布的系统一般是基于 Jenkins 实现的部署工具，上线发布的过程基本也类似，可以半自动化发布，一台或者多台服务部署。部署的过程需要特别注意：日志打印的信息，RPC接口挂载情况，外部调用链接情况，指定IP调用的返回情况等，当所有你需要验证的功能都完毕后，再逐步选中其他服务进行20%、30%这样的量进行发布上线。

### 2.3 监控
系统发布完成以后还需要进行监控的配置，比如：**TP99、TP999、QPS、TPS、可用率、响应时长、负载、IO、网络、慢查询、事务、连接数等等**，都需要从你的监控中有所体现，并能及时把报警信息推送出来。可能你听过一些类似于 Dapper 的非入侵全链路监控，它们是基于**字节码插桩技术** #unknown 实现的，可以在性能损耗 1% 的范围进行间隔采集系统运行情况，并实时展示系统运行监控状况。另外除了**系统监控以外，还有数据库监控、网络监控、应用实例监控**等等，这些监控系统的配合使用，来保证监控的运行。
